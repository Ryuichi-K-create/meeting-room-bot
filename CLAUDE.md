# 会議室予約システム 要件定義書

## 1. プロジェクト概要

### 1.1 システム名
Slack連携 会議室予約システム（Botモーダル版）

### 1.2 目的
Slack Botのモーダル機能を使って会議室の予約・キャンセルを行い、リマインドと予約確認もBotで行うシステムを構築する。

### 1.3 対象ユーザー
- 社内の全従業員（Slackワークスペースのメンバー）

---

## 2. 機能要件

### 2.1 Bot機能（全操作）

#### 2.1.1 予約機能
```
@reserve-bot 予約
```
- モーダル（ポップアップフォーム）が表示される
- 入力項目:

| 項目 | 必須 | 入力形式 | 説明 |
|------|------|----------|------|
| 対象チャンネル | ○ | チャンネル選択 | リマインド通知先のチャンネル |
| 予約日 | ○ | 日付選択 | 予約する日付 |
| 開始時間 | ○ | 時刻選択 | 開始時刻 |
| 終了時間 | ○ | 時刻選択 | 終了時刻 |
| ミーティング名 | ○ | テキスト | 会議の名称 |
| リマインダー | ○ | ドロップダウン | 5分前/15分前/30分前/1時間前/3時間前 |

**処理:**
- 予約時に重複チェックを実行
- 重複がある場合はエラーメッセージを表示して予約を拒否
- 予約完了時は予約用チャンネルに内容を投稿

#### 2.1.2 キャンセル機能
```
@reserve-bot キャンセル
```
- 自分の予約一覧がドロップダウンで表示されるモーダルが開く
- 選択した予約をキャンセル
- キャンセル完了時はチャンネルに通知

#### 2.1.3 予約確認機能
```
@reserve-bot 確認
@reserve-bot 確認 2025/01/15
```
- 指定日（省略時は今日）の予約一覧をメッセージで表示

#### 2.1.4 リマインダー機能
- 会議開始前に対象チャンネルへSlackで自動通知
- 通知タイミングは予約時にユーザーが選択した時間
- APSchedulerで定期的にチェックして送信

#### 2.1.5 ヘルプ機能
```
@reserve-bot ヘルプ
```
- 使い方を表示

### 2.2 通知

#### 2.2.1 予約完了通知
- 予約用チャンネルに予約内容を投稿
- 投稿内容: 対象チャンネル、予約者、日時、ミーティング名、リマインド時間、予約ID

#### 2.2.2 キャンセル通知
- 予約用チャンネルにキャンセルを投稿

#### 2.2.3 リマインダー通知
- 対象チャンネルに通知
- 予約者をメンション

---

## 3. 非機能要件

### 3.1 パフォーマンス
- Bot応答時間: 3秒以内
- 同時リクエスト処理: 10件程度

### 3.2 可用性
- 社内サーバーでの運用を想定
- 24時間の稼働を保証

### 3.3 セキュリティ
- Slackワークスペース内のユーザーのみアクセス可能
- キャンセルは予約者本人のみ可能

---

## 4. システム構成

### 4.1 技術スタック

| 項目 | 技術 |
|------|------|
| バックエンド | Python |
| データベース | SQLite |
| Slack連携 | Slack Bolt for Python |
| スケジューラー | APScheduler（リマインダー用） |

### 4.2 アーキテクチャ

```
┌─────────────────────────────────────────────────────────┐
│                    Slack Workspace                       │
│                                                          │
│  ユーザー ──メンション──▶ @reserve-bot                    │
│                              │                           │
│                              ▼                           │
│                    ┌─────────────────┐                   │
│                    │   モーダル表示   │                   │
│                    │  (予約フォーム)  │                   │
│                    └────────┬────────┘                   │
└─────────────────────────────┼────────────────────────────┘
                              │
                              ▼
                ┌─────────────────────────┐
                │   Slack Bolt Server     │
                │  ┌───────────────────┐  │
                │  │ メンション処理    │  │
                │  │ モーダル処理      │  │
                │  │ APScheduler       │  │
                │  │ (リマインダー)     │  │
                │  └─────────┬─────────┘  │
                └────────────┼────────────┘
                             │
                             ▼
                       ┌──────────┐
                       │  SQLite  │
                       │    DB    │
                       └──────────┘
```

### 4.3 データモデル

#### reservations テーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | INTEGER | 予約ID（主キー） |
| user_id | TEXT | SlackユーザーID |
| user_name | TEXT | 予約者名 |
| channel_id | TEXT | 対象チャンネルID |
| event_name | TEXT | ミーティング名 |
| start_time | DATETIME | 開始日時 |
| end_time | DATETIME | 終了日時 |
| reminder_minutes | INTEGER | リマインダー（分前） |
| reminder_sent | BOOLEAN | リマインダー送信済みフラグ |
| created_at | DATETIME | 作成日時 |

---

## 5. Slack App設定

### 5.1 必要な権限（Bot Token Scopes）
- `app_mentions:read` - メンション読み取り
- `chat:write` - メッセージ送信
- `users:read` - ユーザー情報取得
- `channels:read` - チャンネル情報取得
- `commands` - スラッシュコマンド（オプション）

### 5.2 Interactivity
- モーダル表示のために「Interactivity & Shortcuts」を有効化
- Socket Modeを使用するためRequest URLは不要

### 5.3 Event Subscriptions
- `app_mention` - Botへのメンション

---

## 6. デプロイ要件

### 6.1 環境
- ローカル・社内サーバー
- Python 3.9以上
- 常時起動（systemdまたはDocker）

### 6.2 環境変数
```
SLACK_BOT_TOKEN=xoxb-...
SLACK_SIGNING_SECRET=...
SLACK_APP_TOKEN=xapp-...
DATABASE_PATH=./data/reservations.db
RESERVATION_CHANNEL_ID=C...  # 予約通知用チャンネル
```

---

## 7. 会議室情報

### 7.1 対象会議室
- 会議室数: 1室

---

## 8. 将来の拡張候補

- 複数会議室対応
- 定期予約機能
- Google Calendar連携
- Web UIダッシュボード

---

## 9. 開発フェーズ

### Phase 1: 基本機能（MVP）
- [x] プロジェクト初期設定
- [x] SQLiteデータベース構築
- [ ] 予約モーダル（フォーム表示・重複チェック・登録）
- [ ] キャンセルモーダル（予約一覧・削除）
- [ ] 予約確認コマンド
- [ ] 予約完了・キャンセル通知

### Phase 2: リマインダー機能
- [ ] APSchedulerでリマインダー送信
- [ ] 対象チャンネルへの通知

### Phase 3: 運用準備
- [ ] エラーハンドリング強化
- [ ] ログ機能
- [ ] デプロイスクリプト作成
